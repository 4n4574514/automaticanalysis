<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of aa_report</title>
  <meta name="keywords" content="aa_report">
  <meta name="description" content="Automatic analysis - produces HTML summary of analysis">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="#">aa_engine</a> &gt; aa_report.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./aa_engine&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>aa_report
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Automatic analysis - produces HTML summary of analysis</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [aap]=aa_report(studyroot,stages) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Automatic analysis - produces HTML summary of analysis
 This feature is usable, but still under development.
 Rhodri Cusack MRC CBU Cambridge 2004</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="aas_getsesspath.html" class="code" title="function [sesspath]=aas_getsesspath(aap,i,j)">aas_getsesspath</a>	Automatic analysis - get session path</li><li><a href="aas_getsubjpath.html" class="code" title="function [subjpath]=aas_getsubjpath(aap,i)">aas_getsubjpath</a>	Automatic analysis - get subject path</li><li><a href="aas_log.html" class="code" title="function aas_log(aap,iserr,msg)">aas_log</a>	Automatic analysis - log tool</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Automatic analysis - produces HTML summary of analysis</span>
0002 <span class="comment">% This feature is usable, but still under development.</span>
0003 <span class="comment">% Rhodri Cusack MRC CBU Cambridge 2004</span>
0004 
0005 <a name="_sub0" href="#_subfunctions" class="code">function [aap]=aa_report(studyroot,stages)</a>
0006 
0007 <span class="keyword">if</span> (~exist(<span class="string">'studyroot'</span>,<span class="string">'var'</span>))
0008     studyroot=pwd;
0009 <span class="keyword">end</span>;
0010 
0011 
0012 <span class="comment">% First, load AAP structure</span>
0013 aaploadfn=fullfile(studyroot,<span class="string">'aap_parameters'</span>);
0014 load(aaploadfn);
0015 
0016 <span class="keyword">if</span> (~exist(<span class="string">'stages'</span>))
0017     stages=aap.tasklist.stages;
0018 <span class="keyword">end</span>;
0019 
0020 <span class="keyword">if</span> (~iscell(stages))
0021     stages={stages};
0022 <span class="keyword">end</span>;
0023 
0024 aap.report.html=<span class="string">''</span>;
0025 aap.report.numdependencies=0;
0026 aap.report.dependency={};
0027 
0028 <span class="comment">% make full report by calling individual components</span>
0029 <span class="comment">% stage by stage display</span>
0030 
0031 aap.internal.total=0;
0032 aap.internal.stagesnotdone=0;
0033 
0034 aap.report.html=strcat(aap.report.html,<span class="string">'&lt;table&gt;'</span>);
0035 
0036 <span class="keyword">for</span> i=1:length(aap.acq_details.subjects)
0037     aap.report.html=strcat(aap.report.html,<span class="string">'&lt;tr&gt;&lt;td&gt;'</span>);
0038     aap.report.html=strcat(aap.report.html,[<span class="string">'&lt;h1&gt;Subject: '</span> aap.acq_details.subjects{i} <span class="string">'&lt;/h1&gt;'</span>]);
0039     <span class="keyword">for</span> k=1:length(stages)
0040         aap.report.html=strcat(aap.report.html,<span class="string">'&lt;tr&gt;&lt;td&gt;'</span>);
0041         aap.report.html=strcat(aap.report.html,[<span class="string">'&lt;h2&gt;Stage: '</span> stages{k} <span class="string">'&lt;/h2&gt;'</span>]);
0042 
0043         doneflag=fullfile(aap.acq_details.root,[<span class="string">'done_'</span> stages{k}]);
0044 
0045         <span class="comment">% find out whether this module needs to be executed once per study, subject or session</span>
0046         [aap,domain]=feval(stages{k},aap,<span class="string">'domain'</span>);
0047 
0048         aap.tasklist.currenttask.epiprefix=aap.tasklist.epiprefix{k};
0049 
0050         <span class="keyword">switch</span> (domain)
0051             <span class="keyword">case</span> <span class="string">'study'</span>
0052                 doneflag=fullfile(aap.acq_details.root,[<span class="string">'done_'</span> stages{k}]);
0053                 <span class="keyword">if</span> (length(dir(doneflag)))
0054                     [aap,resp]=feval(stages{k},aap,<span class="string">'report'</span>);
0055                 <span class="keyword">end</span>;
0056             <span class="keyword">case</span> <span class="string">'subject'</span>
0057                 doneflag=fullfile(<a href="aas_getsubjpath.html" class="code" title="function [subjpath]=aas_getsubjpath(aap,i)">aas_getsubjpath</a>(aap,i),[<span class="string">'done_'</span> stages{k}]);
0058                 <span class="keyword">if</span> (length(dir(doneflag)))
0059                     [aap,resp]=feval(stages{k},aap,<span class="string">'report'</span>,i);
0060                 <span class="keyword">end</span>;
0061 
0062             <span class="keyword">case</span> <span class="string">'session'</span>
0063                 aap.report.html=strcat(aap.report.html,<span class="string">'&lt;table&gt;&lt;tr&gt;'</span>);
0064                 <span class="keyword">for</span> j=1:length(aap.acq_details.sessions)
0065                     aap.report.html=strcat(aap.report.html,<span class="string">'&lt;td&gt;'</span>);
0066                     aap.report.html=strcat(aap.report.html,[<span class="string">'&lt;h3&gt;Session: '</span> aap.acq_details.sessions{j} <span class="string">'&lt;/h3&gt;'</span>]);
0067                     doneflag=fullfile(<a href="aas_getsesspath.html" class="code" title="function [sesspath]=aas_getsesspath(aap,i,j)">aas_getsesspath</a>(aap,i,j),[<span class="string">'done_'</span> stages{k}]);
0068                     <span class="keyword">if</span> (length(dir(doneflag)))
0069                         [aap,resp]=feval(stages{k},aap,<span class="string">'report'</span>,i,j);
0070                     <span class="keyword">end</span>;
0071                     aap.report.html=strcat(aap.report.html,<span class="string">'&lt;/td&gt;'</span>);
0072                 <span class="keyword">end</span>;
0073                 aap.report.html=strcat(aap.report.html,<span class="string">'&lt;/tr&gt;&lt;/table&gt;'</span>);
0074             <span class="keyword">otherwise</span>
0075                 <a href="aas_log.html" class="code" title="function aas_log(aap,iserr,msg)">aas_log</a>(aap,1,sprintf(<span class="string">'Unknown domain %s associated with stage %s'</span>,aap.tasklist.domain{k},stages{k}));
0076         <span class="keyword">end</span>;
0077         aap.report.html=strcat(aap.report.html,<span class="string">'&lt;/td&gt;&lt;/tr&gt;'</span>);
0078     <span class="keyword">end</span>;
0079     aap.report.html=strcat(aap.report.html,<span class="string">'&lt;/td&gt;&lt;/tr&gt;'</span>);
0080 
0081 <span class="keyword">end</span>;
0082 aap.report.html=strcat(aap.report.html,<span class="string">'&lt;/table&gt;'</span>);
0083 
0084 htm=aap.report.html;
0085 <span class="keyword">if</span> (isfield(aap.directory_conventions,<span class="string">'reportname'</span>))
0086     reportname=aap.directory_conventions.reportname;
0087 <span class="keyword">else</span>
0088     reportname=<span class="string">'fullreport.htm'</span>;
0089 <span class="keyword">end</span>;
0090 
0091 fid=fopen(fullfile(aap.acq_details.root,reportname),<span class="string">'w'</span>);
0092 fprintf(fid,<span class="string">'%s'</span>,htm);
0093 fclose(fid);
0094 myurl=[<span class="string">'file://'</span> fullfile(aap.acq_details.root,reportname)];
0095 web(myurl);
0096 
0097 <span class="keyword">return</span>;
0098</pre></div>
<hr><address>Generated on Fri 31-Aug-2007 16:39:50 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>